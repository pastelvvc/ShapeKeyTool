# ShapeKey Tool

Unity用のシェイプキー管理ツールです。シェイプキーのグループ化、ロック機能、自動保存機能を提供します。

## 機能

- **シェイプキーのグループ化**: パターンベースの自動グループ化
- **ロック機能**: 特定のシェイプキーをロックして変更を防止
- **手動保存/読み込み**: シェイプキーの状態を手動でコンポーネントに保存/読み込み
- **拡張シェイプキー**: カスタム範囲でのシェイプキー制御
- **TreeView**: 階層的なシェイプキー管理

## インストール

1. `ShapeKeyTool`フォルダをUnityプロジェクトの`Assets`フォルダに配置
2. Unityエディターで`OpenTool > ShapeKey`メニューを選択
3. ShapeKey Toolウィンドウが開きます

## 使用方法

### 基本的な使い方

1. **オブジェクトの選択**: シェイプキーを持つSkinnedMeshRendererを選択
2. **グループ化**: シェイプキーは自動的にパターンベースでグループ化されます
3. **値の調整**: スライダーでシェイプキーの値を調整
4. **ロック**: チェックボックスでシェイプキーをロック/アンロック

### グループ化パターン

以下のパターンでシェイプキーが自動グループ化されます：
- `==` (例: `== 目 ==`)
- `!!` (例: `!! 口 !!`)
- `◇◇` (例: `◇◇ 鼻 ◇◇`)
- `★★` (例: `★★ 髪 ★★`)
- `◆◆` (例: `◆◆ 体 ◆◆`)
- `!!!` (例: `!!! 表情 !!!`)

### 手動保存/読み込み機能

- ファイルメニューから「手動保存」を選択してシェイプキーデータをコンポーネントに保存
- ファイルメニューから「手動読み込み」を選択して保存されたデータを読み込み
- **選択的読み込み**: 読み込み時に以下のデータを個別に選択可能
  - **グループ構成**: グループ名とシェイプキーのリスト（⚠️ 現在のメッシュと整合性を保つため自動調整されます）
    - **グループ名**: グループ名の読み込み
    - **シェイプキー名**: シェイプキー名の読み込み
    - **シェイプキー順序**: シェイプキーの順序の読み込み
    - **メッシュ整合性チェック**: 現在のメッシュとの整合性チェック
  - **シェイプキー値**: 各シェイプキーのweight値
  - **拡張シェイプキー情報**: originalName, minValue, maxValue
  - **ロック状態（グループデータから）**: グループデータに含まれるロック状態
  - **ロック状態（独立データから）**: 独立したロック状態データ
  - **展開状態**: グループの開閉状態
  - **テストスライダー**: グループテストのスライダー値
- `ShapeKeyPersistence`コンポーネントが自動的に追加されます
- 保存されたデータはシーンを再読み込みしても保持されます

### スモークテスト（手動チェックリスト）

以下を新規/既存プロジェクトで順に確認してください：

- 起動: `OpenTool > ShapeKey` でウィンドウが開く
- 選択: `SkinnedMeshRenderer` を選択すると一覧が更新される
- グループ展開/折りたたみ: ヘッダをクリックで切り替わる
- 検索: 右パネルの検索で正規表現/大文字小文字の切替が反映される
- スライダ更新: 値変更で対象 `SkinnedMeshRenderer` に反映される
- 拡張作成: Tree の右クリックから拡張シェイプキー作成/上書きが成功する
- 削除: Tree の右クリックから拡張/通常シェイプキーの削除が反映される
- 保存・読込: ファイルメニューから手動保存/読込、選択的読み込みが動作する

トラブルシュート時は「オプション > 詳細デバッグログを有効化」をオンにしてログを取得してください。

## ファイル構成

```
ShapeKeyTool/
├── Scripts/           # ランタイムスクリプト
│   ├── BlendShape.cs
│   └── ShapeKeyPersistence.cs
├── Editor/            # エディター専用スクリプト
│   ├── ShapeKeyToolWindow.cs
│   ├── ShapeKeyPersistenceEditor.cs
│   ├── ShapeKeyTool.Persistence.cs
│   └── ShapeKeyTool.Models.cs
└── Resources/         # リソースファイル
    └── ShapeKeyData/
```

## 技術仕様

- **Unity 2021.3以降**に対応
- **C#**で記述
- **MonoBehaviour**ベースのコンポーネント
- **EditorWindow**ベースのツールウィンドウ

## ライセンス

このツールは自由に使用・配布できます。

## 更新履歴

- v1.0: 初回リリース
  - シェイプキーのグループ化機能
  - ロック機能
  - 自動保存機能
  - TreeView管理 